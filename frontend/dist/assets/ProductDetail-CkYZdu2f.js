import{j as e,u as ge,a as Ee,d as he,b as re,p as De}from"./index-C3RJHPcl.js";import{r as o,R as Ce,e as Le,f as Oe,L as be,h as Pe}from"./react-vendor-Byl6S4M9.js";import{S as Ue,L as ze,I as ke,T as Me}from"./canvas-vendor-C8lZMoyO.js";import{A as Xe,S as Fe,H as He,U as fe,a as We,T as $e}from"./Toast-B2e9ke_m.js";import{t as Be,a as Ge}from"./analytics-o4OqUApf.js";import"./auth-vendor-Cg5HAGal.js";const N={CONTAINER_MAX_WIDTH:600,CONTAINER_MAX_HEIGHT:700,ARTWORK_MAX_WIDTH:250,ARTWORK_MAX_HEIGHT:250,ARTWORK_MIN_SIZE:50,ARTWORK_MAX_RESIZE:400,EXPORT_PIXEL_RATIO_HIGH:3,EXPORT_PIXEL_RATIO_MEDIUM:2,EXPORT_PIXEL_RATIO_LOW:1,EXPORT_QUALITY_HIGH:1,EXPORT_QUALITY_MEDIUM:.9,EXPORT_QUALITY_LOW:.8},pe={FRONT:{minX:103,maxX:493,minY:100,maxY:550},BACK:{minX:140,maxX:510,minY:100,maxY:550},NECK:{minX:520,maxX:1080,minY:560,maxY:710}},ve=o.forwardRef(({tshirtColor:n="white",artworks:a=[],onArtworkPositionChange:b,onArtworkDelete:R,view:f="front"},C)=>{const[_,O]=o.useState(null),[F,M]=o.useState([]),[P,E]=o.useState(null),H=o.useRef([]),G=o.useRef(null),x=o.useRef(null),K=o.useRef({front:null,back:null,neck:null}),D=o.useRef("front"),[W,$]=o.useState({width:550,height:650});o.useImperativeHandle(C,()=>({downloadImage:()=>{if(!x.current)return;E(null);const c=x.current.toDataURL({pixelRatio:N.EXPORT_PIXEL_RATIO_HIGH,mimeType:"image/png",quality:N.EXPORT_QUALITY_HIGH}),r=document.createElement("a");r.download="tshirt-design.png",r.href=c,document.body.appendChild(r),r.click(),document.body.removeChild(r)},getThumbnail:()=>x.current?x.current.toDataURL({pixelRatio:N.EXPORT_PIXEL_RATIO_LOW,mimeType:"image/png",quality:N.EXPORT_QUALITY_LOW}):null,captureImage:()=>x.current?(E(null),x.current.toDataURL({pixelRatio:N.EXPORT_PIXEL_RATIO_MEDIUM,mimeType:"image/png",quality:N.EXPORT_QUALITY_MEDIUM})):null,getThumbnailBlob:async()=>{if(!x.current)return null;const c=x.current.toDataURL({pixelRatio:N.EXPORT_PIXEL_RATIO_LOW,mimeType:"image/png",quality:N.EXPORT_QUALITY_LOW});return await(await fetch(c)).blob()},deselect:()=>{E(null)}}));const J=c=>{const r=c.toLowerCase();return r==="navy"?{front:"/assets/navy-front.png",back:"/assets/navy-back.png",neck:"/assets/navy-neck.png"}:r==="black"?{front:"/assets/black-front.png",back:"/assets/black-back.png",neck:"/assets/black-neck.png"}:{front:"/assets/blank-tshirt.png",back:"/assets/back-tshirt.jpeg",neck:"/assets/neck-tshirt.jpeg"}};o.useEffect(()=>{const c=i=>new Promise(l=>{const g=new window.Image;g.src=i,g.crossOrigin="anonymous",g.onload=()=>l(g),g.onerror=()=>l(g)}),r=J(n);Promise.all([c(r.front),c(r.back),c(r.neck)]).then(([i,l,g])=>{K.current={front:i,back:l,neck:g};const u=f==="neck"?g:f==="back"?l:i;if(f==="neck"){const m=u.width/u.height,v=1600,L=950;let A=v,I=A/m;I<L&&(I=L,A=I*m),$({width:A,height:I})}else{const m=u.width/u.height,v=600,L=700;let A=v,I=v/m;if(I>L&&(I=L,A=L*m),f==="back"){const U=n?.toLowerCase()||"";U==="white"||U===""?(A=A*1.1,I=I*1.1):U==="navy"&&(A=A*1.02,I=I*1.02)}$({width:A,height:I})}O(u)})},[n,f]),o.useEffect(()=>{if(f===D.current)return;const c=K.current,r=f==="neck"?c.neck:f==="back"?c.back:c.front;if(r){if(f==="neck"){const i=r.width/r.height,l=1600,g=950;let u=l,m=u/i;m<g&&(m=g,u=m*i),$({width:u,height:m})}else{const i=r.width/r.height;let l=N.CONTAINER_MAX_WIDTH,g=N.CONTAINER_MAX_WIDTH/i;if(g>N.CONTAINER_MAX_HEIGHT&&(g=N.CONTAINER_MAX_HEIGHT,l=N.CONTAINER_MAX_HEIGHT*i),f==="back"){const u=n?.toLowerCase()||"";u==="white"||u===""?(l=l*1.1,g=g*1.1):u==="navy"&&(l=l*1.02,g=g*1.02)}$({width:l,height:g})}O(r),D.current=f}},[f]),o.useEffect(()=>{const c=r=>{if((r.key==="Delete"||r.key==="Backspace")&&P&&R){const i=parseInt(P.split("-")[1]);isNaN(i)||(R(i),E(null))}};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[P,R]);const B=o.useRef(new Map);o.useEffect(()=>{if(a.length===0){M([]),E(null),H.current=[];return}(async()=>{const r=a.map(i=>{const l=B.current.get(i.url);return l?Promise.resolve(l):new Promise((g,u)=>{const m=new window.Image;m.src=i.url,m.crossOrigin="anonymous",m.onload=()=>{B.current.set(i.url,m),g(m)},m.onerror=u})});try{const i=await Promise.all(r);M(i),H.current=new Array(i.length).fill(null);const l=a[a.length-1];l&&!l.position&&E(`artwork-${a.length-1}`)}catch(i){console.error("Failed to load artworks:",i)}})()},[a]),o.useEffect(()=>{if(P&&G.current){const c=parseInt(P.split("-")[1]),r=H.current[c];r&&(G.current.nodes([r]),G.current.getLayer()?.batchDraw())}},[P]);const Q=c=>{const r=H.current[c];r&&b&&b({x:r.x(),y:r.y(),scaleX:r.scaleX(),scaleY:r.scaleY(),rotation:r.rotation()},c)},p=c=>{const r=c.target===c.target.getStage(),i=c.target.image===_;(r||i)&&E(null)};return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:e.jsxs("div",{className:"relative flex items-center justify-center",style:{transform:typeof window<"u"&&window.innerWidth<640?`scale(${Math.min(window.innerWidth/600,1)})`:"scale(1)",transformOrigin:"center center"},children:[F.length>0&&P&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-black/80 text-white text-xs px-4 py-2 rounded-full z-10",children:"Drag to move • Corners to resize • Rotate to spin • Click away to finish"}),F.length>0&&!P&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-gray-800/60 text-white text-xs px-4 py-2 rounded-full z-10",children:"Click artwork to edit position and size"}),e.jsx(Ue,{ref:x,width:W.width,height:W.height,onMouseDown:p,onTouchStart:p,children:e.jsxs(ze,{children:[_&&e.jsx(ke,{image:_,x:0,y:0,width:W.width,height:W.height,onClick:()=>E(null),onTap:()=>E(null),...f==="neck"?{crop:{x:0,y:0,width:_.width,height:_.height}}:{}}),F.map((c,r)=>{const i=a[r];if(!i)return null;const l=c.width/c.height;let g=N.ARTWORK_MAX_WIDTH,u=N.ARTWORK_MAX_WIDTH/l;return u>N.ARTWORK_MAX_HEIGHT&&(u=N.ARTWORK_MAX_HEIGHT,g=N.ARTWORK_MAX_HEIGHT*l),e.jsxs(Ce.Fragment,{children:[e.jsx(ke,{ref:m=>{H.current[r]=m},image:c,x:i.position?.x??(f==="neck"?750:200+r*20),y:i.position?.y??(f==="neck"?500:250+r*20),width:g,height:u,scaleX:i.position?.scaleX??1,scaleY:i.position?.scaleY??1,rotation:i.position?.rotation??0,draggable:!0,dragBoundFunc:m=>{const v=f==="neck"?pe.NECK:f==="back"?pe.BACK:pe.FRONT,L=H.current[r];if(!L)return m;const A=L.getClientRect(),I=A.width,U=A.height;let X=m.x,Y=m.y;const z=A.x-L.x(),V=A.y-L.y();return X+z<v.minX&&(X=v.minX-z),X+z+I>v.maxX&&(X=v.maxX-I-z),Y+V<v.minY&&(Y=v.minY-V),Y+V+U>v.maxY&&(Y=v.maxY-U-V),{x:X,y:Y}},onClick:()=>E(`artwork-${r}`),onTap:()=>E(`artwork-${r}`),onDragEnd:()=>Q(r),onTransformEnd:()=>Q(r)}),P===`artwork-${r}`&&e.jsx(Me,{ref:G,keepRatio:!0,boundBoxFunc:(m,v)=>v.width<N.ARTWORK_MIN_SIZE||v.height<N.ARTWORK_MIN_SIZE||v.width>N.ARTWORK_MAX_RESIZE||v.height>N.ARTWORK_MAX_RESIZE?m:v,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],rotateEnabled:!0,borderStroke:"#000000",borderStrokeWidth:2,anchorSize:12,anchorStroke:"#000000",anchorFill:"#ffffff",anchorCornerRadius:6})]},`artwork-${r}`)})]})})]})})});ve.displayName="TShirtCanvas";const ye=12.98,Ye=5,Ke=1,Ve=(n,a,b,R)=>{let f=R;return[n,a].filter(Boolean).length===2&&(f+=Ye),b&&(f+=Ke),f},we=["S","M","L","XL","2XL","3XL"],ae=4,qe="http://localhost:3001",q=n=>n?n.startsWith("http")?n:`${qe}${n}`:"",Je=n=>URL.createObjectURL(n),Ne=300,Qe=async(n,a)=>{const b=new DataView(n);try{if(a==="image/png")return Ze(b);if(a==="image/jpeg")return et(b)}catch(R){console.error("Error reading DPI:",R)}return null},Ze=n=>{let a=8;for(;a<n.byteLength;){const b=n.getUint32(a);if(String.fromCharCode(n.getUint8(a+4),n.getUint8(a+5),n.getUint8(a+6),n.getUint8(a+7))==="pHYs"){const f=n.getUint32(a+8);if(n.getUint8(a+16)===1)return Math.round(f/39.3701)}a+=b+12}return null},et=n=>{let a=2;for(;a<n.byteLength;){if(n.getUint16(a)===65504){const f=n.getUint8(a+11),C=n.getUint16(a+12);if(f===1)return C;if(f===2)return Math.round(C*2.54);break}const R=n.getUint16(a+2);a+=R+2}return null},tt=async n=>{if(n.type!=="image/png"&&n.type!=="image/jpeg")return{valid:!0,dpi:null};const a=await n.arrayBuffer(),b=await Qe(a,n.type);return{valid:!b||b>=Ne,dpi:b}},st=n=>window.confirm(`Warning: This image has a DPI of ${n}, which is below the required ${Ne} DPI for high-quality DTG printing. The print quality may be poor.

Do you want to upload it anyway?`),rt=()=>{const n=new Date;let a=7,b=new Date(n);for(;a>0;)b.setDate(b.getDate()+1),b.getDay()!==0&&b.getDay()!==6&&a--;const R=b.getDate(),C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][b.getMonth()];return`${R} ${C}`};function at({product:n,variants:a}){const b=Le(),R=ge(s=>s.addItem),f=ge(s=>s.updateItem),C=ge(s=>s.getItem),_=o.useRef(null),{isAuthenticated:O}=Ee(),[F]=Oe(),[M,P]=o.useState(null),[E,H]=o.useState(null),G=o.useRef(null);o.useEffect(()=>{Be(n.title)},[]);const[x,K]=o.useState(""),[D,W]=o.useState(""),[$,J]=o.useState(null),[B,Q]=o.useState(1),[p,c]=o.useState("front"),[r,i]=o.useState([]),[l,g]=o.useState(null),[u,m]=o.useState([]),v=()=>p==="front"?r:p==="neck"?l?[l]:[]:p==="back"?u:[],L=v()[0]||null,[A,I]=o.useState(!1),[U,X]=o.useState(""),[Y,z]=o.useState(!1),[V,Z]=o.useState(""),ne=Ve(r.length>0,u.length>0,l!==null,ye),oe=[...new Set(a.map(s=>s.color))],je=oe.includes("Navy")?oe:[...oe,"Navy"],_e=[...new Set(a.map(s=>s.size))].sort((s,t)=>we.indexOf(s)-we.indexOf(t));o.useEffect(()=>{if(x&&D){const s=a.find(t=>t.color===x&&t.size===D);J(s||null)}},[x,D,a]),o.useEffect(()=>{const s=F.get("designId");s&&O&&a.length>0&&G.current!==s&&(G.current=s,Ie(s))},[F,O,a]),o.useEffect(()=>{const s=F.get("editCartItem");if(s){const t=C(s);t&&(H(s),K(t.variantColor),W(t.variantSize),Q(t.quantity),t.customization&&(t.customization.frontArtworks&&i(t.customization.frontArtworks),t.customization.backArtworks&&m(t.customization.backArtworks),t.customization.neckArtwork&&g(t.customization.neckArtwork)))}},[F,C]);const Ie=async s=>{try{const t=await he.getById(s);console.log("[LOAD] Full design object:",JSON.stringify(t,null,2)),P(t.id),X(t.name);const h=t.artwork_ids||[],y=t.artwork_urls||{};let k=0;if(t.design_data){if(t.design_data.front&&t.design_data.front.length>0){const d=t.design_data.front.map(T=>{const S=h[k],me=S?q(y[S]):"";return k++,{url:me||"",position:T,assetId:S}});i(d)}if(t.design_data.back&&t.design_data.back.length>0){const d=t.design_data.back.map(T=>{const S=h[k],me=S?q(y[S]):"";return k++,{url:me||"",position:T,assetId:S}});m(d)}if(t.design_data.neck&&t.design_data.neck.length>0){const d=h[k],T=d?q(y[d]):"";g({url:T||"",position:t.design_data.neck[0],assetId:d})}}console.log("[LOAD] Design variant_id:",t.variant_id),console.log("[LOAD] Design variant_color:",t.variant_color),console.log("[LOAD] Design variant_size:",t.variant_size),console.log("[LOAD] Design data color/size:",t.design_data?.selectedColor,t.design_data?.selectedSize);let j=null,w=null;if(t.design_data?.selectedColor){console.log("[LOAD] Using color from design_data (highest priority):",t.design_data.selectedColor),j=t.design_data.selectedColor,w=t.design_data.selectedSize||"M";const d=a.find(T=>T.color===j&&T.size===w);d?(console.log("[LOAD] Found matching variant for design_data color:",d),J(d)):console.log("[LOAD] No variant found for color:",j,"(UI-only color like Navy)")}else if(t.variant_id){let d=a.find(T=>T.id===t.variant_id);console.log("[LOAD] Found variant by ID:",d),!d&&t.variant_color&&t.variant_size&&(console.log("[LOAD] Variant ID not found, trying color/size lookup:",t.variant_color,t.variant_size),d=a.find(T=>T.color===t.variant_color&&T.size===t.variant_size),console.log("[LOAD] Found variant by color/size:",d)),d?(console.log("[LOAD] Setting color/size/variant from variant:",d.color,d.size),j=d.color,w=d.size,J(d)):t.variant_color&&(console.log("[LOAD] No variant found, using color from JOIN:",t.variant_color),j=t.variant_color,w=t.variant_size)}j&&(K(j),W(w||"M"))}catch(t){console.error("Error loading design:",t),alert("Failed to load design")}},ie=async s=>{const t=s.target.files?.[0];if(t)try{const{valid:h,dpi:y}=await tt(t);if(!h&&y&&!st(y)){s.target.value="";return}const j={url:Je(t),position:null,assetId:void 0};if(p==="front")if(r.length<ae){const w=r.length;i([...r,j]),re.uploadFile(t).then(d=>{i(T=>{const S=[...T];return S[w]&&(S[w]={url:q(d.file_url),position:S[w].position,assetId:d.id}),S})}).catch(d=>console.error("Upload failed:",d))}else{alert(`Maximum ${ae} artworks allowed on front view`),s.target.value="";return}else if(p==="neck"){if(l){alert("Only 1 artwork allowed on neck view. Remove existing artwork first."),s.target.value="";return}g(j),re.uploadFile(t).then(w=>{g(d=>({url:q(w.file_url),position:d?.position||null,assetId:w.id}))}).catch(w=>console.error("Upload failed:",w))}else if(p==="back")if(u.length<ae){const w=u.length;m([...u,j]),re.uploadFile(t).then(d=>{m(T=>{const S=[...T];return S[w]&&(S[w]={url:q(d.file_url),position:S[w].position,assetId:d.id}),S})}).catch(d=>console.error("Upload failed:",d))}else{alert(`Maximum ${ae} artworks allowed on back view`),s.target.value="";return}s.target.value=""}catch(h){console.error("File upload failed:",h),alert("Failed to upload file"),s.target.value=""}},Ae=()=>{_.current&&_.current.downloadImage&&_.current.downloadImage()},Te=async()=>{if(!O){b("/login",{state:{from:window.location.pathname+window.location.search}});return}if(M&&U){try{await xe(U),Z("Design updated successfully!"),z(!0),setTimeout(()=>z(!1),3e3)}catch(s){console.error("Error updating design:",s),alert("Failed to update design")}return}I(!0)},xe=async s=>{try{const t={front:r.map(k=>k.position),back:u.map(k=>k.position),neck:l?[l.position]:[],selectedColor:x,selectedSize:D||"M"},h=[...r.filter(k=>k.assetId).map(k=>k.assetId),...u.filter(k=>k.assetId).map(k=>k.assetId),...l?.assetId?[l.assetId]:[]];let y="";if(_.current&&_.current.getThumbnailBlob)try{const k=await _.current.getThumbnailBlob();if(k){const j=new File([k],"thumbnail.png",{type:"image/png"});y=(await re.uploadFile(j)).file_url}}catch(k){console.error("Failed to capture thumbnail:",k)}if(M){const k=D||"M",j=$||(x?a.find(w=>w.color===x&&w.size===k):null);console.log("[SAVE] Updating design with variant:",{variantId:j?.id,color:x,size:D,variant:j}),await he.update(M,{name:s,variantId:j?.id,designData:t,artworkIds:h,thumbnailUrl:y}),X(s)}else{const k=D||"M",j=$||(x?a.find(d=>d.color===x&&d.size===k):null);console.log("[SAVE] Saving new design with variant:",{variantId:j?.id,color:x,size:D,variant:j});const w=await he.save({name:s,productId:n.id,variantId:j?.id,designData:t,artworkIds:h,thumbnailUrl:y});P(w.id),X(s),Ge(s)}}catch(t){throw console.error("Error saving design:",t),t}},Se=()=>{if(!x||!D){Z("Please select a color and size"),z(!0);return}let s;try{_.current&&_.current.captureImage&&(s=_.current.captureImage())}catch(y){console.error("Error capturing mockup:",y)}const t=$||{id:`temp-${x}-${D}`},h={id:E||`${t.id}-${Date.now()}`,variantId:t.id,productTitle:n.title,variantColor:x,variantSize:D,quantity:B,unitPrice:ne,customization:{method:"dtg",frontArtworks:r,backArtworks:u,neckArtwork:l},mockupUrl:s};E?(f(E,h),Z("Cart item updated successfully!")):(R(h),Z("Added to cart successfully!")),z(!0),setTimeout(()=>{b("/cart")},1500)},[le,Re]=o.useState(!0),[ce,ee]=o.useState(!1),[de,te]=o.useState(!1),[ue,se]=o.useState(!1);return o.useEffect(()=>{p==="neck"?(se(!0),ee(!1),te(!1)):p==="front"?(ee(!0),te(!1),se(!1)):p==="back"&&(te(!0),ee(!1),se(!1))},[p]),e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-gray-200 bg-white sticky top-0 z-50",children:e.jsxs("div",{className:"relative px-3 sm:px-6 py-3 sm:py-1.5 flex items-center justify-between",children:[e.jsx("div",{className:"hidden sm:block text-sm font-bold min-w-0",children:n.title}),e.jsx(be,{to:"/",className:"sm:hidden text-sm font-medium text-gray-600 hover:text-gray-900",children:"← Back"}),e.jsx(be,{to:"/",className:"hidden sm:block absolute left-1/2 -translate-x-1/2 text-lg font-bold hover:text-gray-600 transition-colors",children:"Raspberry"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("button",{onClick:Ae,disabled:!L,title:"Download Design",className:`hidden sm:flex p-2 rounded-md transition-colors ${L?"text-gray-700 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"}`,children:e.jsx(Xe,{size:18})}),e.jsxs("button",{onClick:Te,className:"flex items-center gap-1.5 px-3 sm:px-4 py-2 sm:py-1.5 text-xs font-medium rounded-md transition-colors bg-black text-white hover:bg-gray-800",children:[e.jsx(Fe,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:M?"Update":"Save"}),e.jsx("span",{className:"sm:hidden",children:M?"Update":"Save"})]}),e.jsxs("div",{className:"hidden md:block text-sm font-normal whitespace-nowrap",children:["from $",ye.toFixed(2)]})]})]})}),e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[1fr_400px] lg:h-[calc(100vh-40px)]",children:[e.jsxs("div",{className:"bg-white flex flex-col relative h-[60vh] lg:h-full overflow-hidden order-1",children:[e.jsx("div",{className:`absolute inset-0 flex items-center justify-center ${p==="neck"?"pt-0 pb-0 px-0":"pt-2 pb-16 lg:pb-16 px-2 sm:px-6"}`,children:n.slug==="classic-hoodie"?e.jsx(He,{ref:_,artworks:v(),view:p,onArtworkPositionChange:(s,t)=>{if(p==="front"){const h=[...r];h[t]={...h[t],position:s},i(h)}else if(p==="neck"&&l)g({...l,position:s});else if(p==="back"){const h=[...u];h[t]={...h[t],position:s},m(h)}},onArtworkDelete:s=>{if(p==="front"){const t=r.filter((h,y)=>y!==s);i(t)}else if(p==="neck")g(null);else if(p==="back"){const t=u.filter((h,y)=>y!==s);m(t)}}}):e.jsx(ve,{ref:_,tshirtColor:x,artworks:v(),view:p,onArtworkPositionChange:(s,t)=>{if(p==="front"){const h=[...r];h[t]={...h[t],position:s},i(h)}else if(p==="neck"&&l)g({...l,position:s});else if(p==="back"){const h=[...u];h[t]={...h[t],position:s},m(h)}},onArtworkDelete:s=>{if(p==="front"){const t=r.filter((h,y)=>y!==s);i(t)}else if(p==="neck")g(null);else if(p==="back"){const t=u.filter((h,y)=>y!==s);m(t)}}})}),e.jsxs("div",{className:"absolute bottom-4 lg:bottom-8 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg px-1.5 sm:px-2 py-1.5 sm:py-2 flex gap-1",children:[e.jsx("button",{onClick:()=>c("front"),className:`px-4 sm:px-5 py-2.5 sm:py-2 rounded-full text-sm font-medium transition-colors ${p==="front"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Front"}),e.jsx("button",{onClick:()=>c("back"),className:`px-4 sm:px-5 py-2.5 sm:py-2 rounded-full text-sm font-medium transition-colors ${p==="back"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Back"}),e.jsx("button",{onClick:()=>c("neck"),className:`px-4 sm:px-5 py-2.5 sm:py-2 rounded-full text-sm font-medium transition-colors ${p==="neck"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Neck"})]})]}),e.jsx("div",{className:"bg-white border-t lg:border-t-0 lg:border-l border-gray-200 overflow-y-auto order-2 max-h-[40vh] lg:max-h-none",children:e.jsxs("div",{className:"p-4 sm:p-5 space-y-1 pb-24 lg:pb-5",children:[e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>Re(!le),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Garment Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[x&&e.jsx("span",{className:"w-5 h-5 rounded-full border border-gray-300",style:{backgroundColor:x==="White"?"#FFFFFF":x==="Black"?"#000000":x.toLowerCase()}}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:le?"−":"+"})]})]}),le&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider mb-3",children:"Pre-developed"}),e.jsx("div",{className:"grid grid-cols-2 gap-2.5",children:je.map(s=>e.jsxs("button",{onClick:()=>K(s),className:`flex items-center gap-2.5 p-2.5 rounded-md border transition-all ${x===s?"border-gray-900 bg-gray-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"w-8 h-8 rounded-full border border-gray-300 flex-shrink-0",style:{backgroundColor:s==="White"?"#FFFFFF":s==="Black"?"#000000":s==="Navy"?"#001f3f":s.toLowerCase()}}),e.jsx("span",{className:"text-xs font-medium",children:s})]},s))})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>ee(!ce),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Front Artwork"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:r.length}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:ce?"−":"+"})]})]}),ce&&e.jsxs("div",{className:"space-y-4",children:[r.length<4&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>c("front"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:s=>{c("front"),ie(s)},className:"hidden",id:"front-artwork-upload",onClick:s=>s.stopPropagation()}),e.jsxs("label",{htmlFor:"front-artwork-upload",className:"cursor-pointer",children:[e.jsx(fe,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload front artwork (up to 4)"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),r.map((s,t)=>e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:s.url,alt:"Front Artwork",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",children:["Artwork ",t+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click front view to edit"})]})]}),e.jsx("button",{onClick:()=>{i(r.filter((h,y)=>y!==t))},className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})},t))]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>te(!de),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Back Artwork"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:u.length}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:de?"−":"+"})]})]}),de&&e.jsxs("div",{className:"space-y-4",children:[u.length<4&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>c("back"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:s=>{c("back"),ie(s)},className:"hidden",id:"back-artwork-upload",onClick:s=>s.stopPropagation()}),e.jsxs("label",{htmlFor:"back-artwork-upload",className:"cursor-pointer",children:[e.jsx(fe,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload back artwork (up to 4)"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),u.map((s,t)=>e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:s.url,alt:"Back Artwork",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",children:["Artwork ",t+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click back view to edit"})]})]}),e.jsx("button",{onClick:()=>{m(u.filter((h,y)=>y!==t))},className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})},t))]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>se(!ue),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Neck Label"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:l?"1":"0"}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:ue?"−":"+"})]})]}),ue&&e.jsxs("div",{className:"space-y-4",children:[!l&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>c("neck"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:s=>{c("neck"),ie(s)},className:"hidden",id:"neck-label-upload",onClick:s=>s.stopPropagation()}),e.jsxs("label",{htmlFor:"neck-label-upload",className:"cursor-pointer",children:[e.jsx(fe,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload neck label"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),l&&e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:l.url,alt:"Neck Label",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",children:"Neck Label"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click neck view to edit"})]})]}),e.jsx("button",{onClick:()=>g(null),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsx("label",{className:"block text-xs font-medium mb-3",children:"Size"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:_e.map(s=>e.jsx("button",{onClick:()=>W(s),className:`px-3 py-2 border rounded-md text-xs font-medium transition-all ${D===s?"border-black bg-black text-white":"border-gray-300 hover:border-gray-400"}`,children:s},s))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-5 pb-4",children:e.jsxs("div",{className:`grid ${B>=2?"grid-cols-4":"grid-cols-3"} gap-3`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:B,onChange:s=>Q(parseInt(s.target.value)||1),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Unit cost"}),e.jsxs("div",{className:"text-sm font-semibold",children:["$",ne.toFixed(2)]})]}),B>=2&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Total cost"}),e.jsxs("div",{className:"text-sm font-semibold",children:["$",(ne*B).toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Delivery"}),e.jsx("div",{className:"text-xs font-semibold",children:rt()})]})]})}),e.jsx("div",{className:"pt-4 lg:relative fixed bottom-0 left-0 right-0 p-4 bg-white border-t lg:border-t-0 border-gray-200 lg:p-0 shadow-lg lg:shadow-none",children:e.jsx("button",{onClick:Se,disabled:!x||!D,className:"w-full py-3.5 sm:py-3 bg-black text-white text-base sm:text-sm font-medium rounded-full hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:E?"Update Cart":"Add to Cart"})})]})})]}),e.jsx(We,{isOpen:A,onClose:()=>I(!1),onSave:xe,isUpdating:!!M,currentName:U}),Y&&e.jsx($e,{message:V,type:"success",onClose:()=>z(!1)})]})}function ut(){const{slug:n}=Pe(),[a,b]=o.useState(null),[R,f]=o.useState(!0),[C]=o.useState(null);return o.useEffect(()=>{if(!n)return;b({product:{id:"1",title:"Classic Cotton T-Shirt",slug:"classic-tee",description:"Premium 100% cotton t-shirt. Soft, comfortable, and perfect for custom designs.",images:["/assets/blank-tshirt.png"],status:"active",variants:[{id:"1",product_id:"1",color:"White",size:"S",sku:"TEE-WHT-S",base_price:12.99,stock_level:100},{id:"2",product_id:"1",color:"White",size:"M",sku:"TEE-WHT-M",base_price:12.99,stock_level:100},{id:"3",product_id:"1",color:"White",size:"L",sku:"TEE-WHT-L",base_price:12.99,stock_level:100},{id:"4",product_id:"1",color:"Black",size:"S",sku:"TEE-BLK-S",base_price:12.99,stock_level:100},{id:"5",product_id:"1",color:"Black",size:"M",sku:"TEE-BLK-M",base_price:12.99,stock_level:100},{id:"6",product_id:"1",color:"Black",size:"L",sku:"TEE-BLK-L",base_price:12.99,stock_level:100},{id:"7",product_id:"1",color:"Navy",size:"S",sku:"TEE-NAV-S",base_price:12.99,stock_level:100},{id:"8",product_id:"1",color:"Navy",size:"M",sku:"TEE-NAV-M",base_price:12.99,stock_level:100},{id:"9",product_id:"1",color:"Navy",size:"L",sku:"TEE-NAV-L",base_price:12.99,stock_level:100}]},decorationMethods:[{id:"1",name:"dtg",display_name:"Direct to Garment",description:"Full-color digital printing",pricing_rules:{base_price:10,per_location:6,quantity_breaks:[{min:1,max:5,multiplier:1},{min:6,max:11,multiplier:.95},{min:12,max:null,multiplier:.85}]},file_requirements:{min_dpi:300,accepted_formats:["png","jpg","pdf"]}}]}),f(!1),De.getBySlug(n).then(O=>{O&&O.product&&b(O)}).catch(O=>{console.log("Using mock data, API unavailable:",O.message)})},[n]),R?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading product..."})]})}):C||!a?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-red-600 text-lg",children:C||"Product not found"})})}):e.jsx(at,{product:a.product,variants:a.product.variants})}export{ut as default};
