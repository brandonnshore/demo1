import{c as E,j as t,S as J}from"./index-C2P-5dtT.js";import{r as n,R as Q}from"./react-vendor-Byl6S4M9.js";import{S as Z,L as ee,I as P,T as te,K as se}from"./canvas-vendor-C8lZMoyO.js";import{X as A}from"./x-C2VAmvyw.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=E("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=E("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=E("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=E("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),H={front:"/assets/hoodie-black-front.png",back:"/assets/hoodie-black-back.png",neck:"/assets/hoodie-black-back.png"},_=600,z=700,W=1.15,ae=n.forwardRef(({artworks:m=[],onArtworkPositionChange:g,onArtworkDelete:f,view:o="front"},j)=>{const[l,b]=n.useState(null),[u,v]=n.useState([]),[c,d]=n.useState(null),x=n.useRef([]),p=n.useRef(null),h=n.useRef(null),N=n.useRef({front:null,back:null,neck:null}),k=n.useRef(new Map),[I,L]=n.useState({width:690,height:805});n.useImperativeHandle(j,()=>({downloadImage:()=>{if(!h.current)return;const a=h.current.toDataURL({pixelRatio:3,mimeType:"image/png",quality:1}),e=document.createElement("a");e.download="hoodie-design.png",e.href=a,document.body.appendChild(e),e.click(),document.body.removeChild(e)},captureImage:()=>h.current?h.current.toDataURL({pixelRatio:2,mimeType:"image/png",quality:.9}):null,getThumbnailBlob:async()=>{if(!h.current)return null;const a=h.current.toDataURL({pixelRatio:1,mimeType:"image/png",quality:.8});return await(await fetch(a)).blob()}}));const X=a=>new Promise(e=>{const s=new window.Image;s.src=a,s.crossOrigin="anonymous",s.onload=()=>e(s),s.onerror=()=>e(s)}),M=a=>{const e=a.width/a.height;let s=_,r=_/e;return r>z&&(r=z,s=z*e),s*=W,r*=W,{width:s,height:r}};n.useEffect(()=>{Promise.all([X(H.front),X(H.back),X(H.neck)]).then(([a,e,s])=>{N.current={front:a,back:e,neck:s};const r=o==="neck"?s:o==="back"?e:a;L(M(r)),b(r)})},[]),n.useEffect(()=>{const a=N.current,e=o==="neck"?a.neck:o==="back"?a.back:a.front;e&&(L(M(e)),b(e))},[o]),n.useEffect(()=>{const a=e=>{if((e.key==="Delete"||e.key==="Backspace")&&c&&f){const s=parseInt(c.split("-")[1]);isNaN(s)||(f(s),d(null))}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[c,f]),n.useEffect(()=>{if(m.length===0){v([]),d(null),x.current=[];return}(async()=>{const e=m.map(s=>{const r=k.current.get(s.url);return r?Promise.resolve(r):new Promise((S,C)=>{const y=new window.Image;y.src=s.url,y.crossOrigin="anonymous",y.onload=()=>{k.current.set(s.url,y),S(y)},y.onerror=C})});try{const s=await Promise.all(e);v(s),x.current=new Array(s.length).fill(null);const r=m[m.length-1];r&&!r.position&&d(`artwork-${m.length-1}`)}catch(s){console.error("Failed to load artworks:",s)}})()},[m]),n.useEffect(()=>{if(c&&p.current){const a=parseInt(c.split("-")[1]),e=x.current[a];e&&(p.current.nodes([e]),p.current.getLayer()?.batchDraw())}},[c]);const F=a=>{const e=x.current[a];e&&g&&g({x:e.x(),y:e.y(),scaleX:e.scaleX(),scaleY:e.scaleY(),rotation:e.rotation()},a)},O=a=>{const e=a.target===a.target.getStage(),s=a.target instanceof se.Image&&a.target.image()===l;(e||s)&&d(null)};return t.jsxs("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:[u.length>0&&c&&t.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-black/80 text-white text-xs px-4 py-2 rounded-full z-10",children:"Drag to move â€¢ Corners to resize â€¢ Rotate to spin â€¢ Click away to finish"}),u.length>0&&!c&&t.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-gray-800/60 text-white text-xs px-4 py-2 rounded-full z-10",children:"Click artwork to edit position and size"}),t.jsx(Z,{ref:h,width:I.width,height:I.height,onMouseDown:O,onTouchStart:O,children:t.jsxs(ee,{children:[l&&t.jsx(P,{image:l,x:0,y:o==="back"?-20:0,width:I.width,height:I.height,onClick:()=>d(null),onTap:()=>d(null)}),u.map((a,e)=>{const s=m[e];if(!s)return null;const r=250,S=250,C=a.width/a.height;let y=r,Y=r/C;return Y>S&&(Y=S,y=S*C),t.jsxs(Q.Fragment,{children:[t.jsx(P,{ref:w=>{x.current[e]=w},image:a,x:s.position?.x??200+e*20,y:s.position?.y??250+e*20,width:y,height:Y,scaleX:s.position?.scaleX??1,scaleY:s.position?.scaleY??1,rotation:s.position?.rotation??0,draggable:!0,dragBoundFunc:w=>{const i=o==="back"?{minX:120,maxX:510,minY:100,maxY:650}:{minX:80,maxX:470,minY:100,maxY:650},D=x.current[e],K=D?.width()||0,G=D?.height()||0,V=D?.scaleX()||1,B=D?.scaleY()||1,U=K*V,$=G*B;let R=w.x,T=w.y;return R<i.minX&&(R=i.minX),R+U>i.maxX&&(R=i.maxX-U),T<i.minY&&(T=i.minY),T+$>i.maxY&&(T=i.maxY-$),{x:R,y:T}},onClick:()=>d(`artwork-${e}`),onTap:()=>d(`artwork-${e}`),onDragEnd:()=>F(e),onTransformEnd:()=>F(e)}),c===`artwork-${e}`&&t.jsx(te,{ref:p,keepRatio:!0,boundBoxFunc:(w,i)=>i.width<50||i.height<50||i.width>400||i.height>400?w:i,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],rotateEnabled:!0,borderStroke:"#000000",borderStrokeWidth:2,anchorSize:12,anchorStroke:"#000000",anchorFill:"#ffffff",anchorCornerRadius:6})]},`artwork-${e}`)})]})})]})});ae.displayName="HoodieCanvas";function me({isOpen:m,onClose:g,onSave:f,isUpdating:o=!1,currentName:j=""}){const[l,b]=n.useState(j),[u,v]=n.useState(!1),[c,d]=n.useState(!1),[x,p]=n.useState(""),h=async()=>{if(!l.trim()){p("Please enter a name for your design");return}v(!0),p("");try{await f(l.trim()),d(!0),setTimeout(()=>{g(),d(!1),b("")},1500)}catch(k){p(k.message||"Failed to save design"),v(!1)}},N=()=>{u||(g(),b(""),p(""),d(!1))};return m?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-2xl font-bold",children:o?"Update Design":"Save Design"}),!u&&t.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(A,{size:24})})]}),t.jsx("div",{className:"p-6",children:c?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:t.jsx(q,{size:32,className:"text-green-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o?"Design Updated!":"Design Saved!"}),t.jsxs("p",{className:"text-gray-600",children:['Your design "',l,'" has been saved to your dashboard']})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"design-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Design Name"}),t.jsx("input",{id:"design-name",type:"text",value:l,onChange:k=>b(k.target.value),onKeyPress:k=>k.key==="Enter"&&h(),placeholder:"e.g., Summer Collection Tee",className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",disabled:u,autoFocus:!0}),x&&t.jsx("p",{className:"mt-2 text-sm text-red-600",children:x})]}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:t.jsxs("p",{className:"text-sm text-gray-600",children:["ðŸ’¡ ",t.jsx("strong",{children:"Tip:"})," Give your design a memorable name so you can easily find it later!"]})})]})}),!c&&t.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[t.jsx("button",{onClick:N,disabled:u,className:"flex-1 px-4 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),t.jsx("button",{onClick:h,disabled:u||!l.trim(),className:"flex-1 px-4 py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?t.jsxs("span",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):o?"Update Design":"Save Design"})]})]})}):null}function ue({message:m,type:g="success",onClose:f,duration:o=3e3}){n.useEffect(()=>{const b=setTimeout(()=>{f()},o);return()=>clearTimeout(b)},[f,o]);const j={success:t.jsx(q,{size:20}),error:t.jsx(A,{size:20}),info:t.jsx(J,{size:20})},l={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"};return t.jsxs("div",{className:"fixed bottom-8 right-8 z-50 animate-slideUp",role:"alert",children:[t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden max-w-md",children:[t.jsxs("div",{className:"flex items-center gap-4 p-4",children:[t.jsx("div",{className:`${l[g]} text-white p-2 rounded-xl flex-shrink-0`,children:j[g]}),t.jsx("p",{className:"text-gray-900 font-medium flex-1",children:m}),t.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"Close",children:t.jsx(A,{size:18})})]}),t.jsx("div",{className:"h-1 bg-gray-100",children:t.jsx("div",{className:`h-full ${l[g]} transition-all`,style:{animation:`shrink ${o}ms linear`,transformOrigin:"left"}})})]}),t.jsx("style",{children:`
        @keyframes slideUp {
          from {
            transform: translateY(100px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        @keyframes shrink {
          from {
            width: 100%;
          }
          to {
            width: 0%;
          }
        }
      `})]})}export{le as A,ae as H,ce as S,ue as T,de as U,me as a};
