import{j as e,u as _,o as N}from"./index-C42U2fQf.js";import{r as u,e as k}from"./react-vendor-Byl6S4M9.js";import{u as q,P as I,E as R,l as M,a as T,C as S}from"./stripe-vendor-MUlDB4Bh.js";import"./auth-vendor-BK_4TCcA.js";function z({totalAmount:o,onPaymentSuccess:d}){const p=q(),[r,n]=u.useState(null),[v,j]=u.useState(!1);return u.useEffect(()=>{if(!p)return;const c=p.paymentRequest({country:"US",currency:"usd",total:{label:"Total",amount:Math.round(o*100)},requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:!0,requestShipping:!0,shippingOptions:[{id:"free-shipping",label:"Free Shipping",detail:"Arrives in 5-7 business days",amount:0}]});return c.canMakePayment().then(m=>{m&&(n(c),j(!0))}),c.on("paymentmethod",async m=>{try{await d(m.paymentMethod.id),m.complete("success")}catch(x){console.error("Payment failed:",x),m.complete("fail")}}),()=>{c.off("paymentmethod")}},[p,o,d]),u.useEffect(()=>{r&&r.update({total:{label:"Total",amount:Math.round(o*100)}})},[o,r]),!v||!r?null:e.jsxs("div",{className:"mb-6",children:[e.jsx(I,{options:{paymentRequest:r,style:{paymentRequestButton:{type:"default",theme:"dark",height:"48px"}}}}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-500",children:"Or pay with card"})})]})]})}const F=M("pk_test_51S6MQDEDQ6axpLThLLd3vs0vMlnBCJJ5rJnTonlS2iaMWrBii8UXoosY3CLLoXqOu7SyqhapEC7WTapzAuG4QtJR00CZ7ndWUt");function L(){const o=k(),d=q(),p=T(),{items:r,getTotalPrice:n,clearCart:v}=_(),[j,c]=u.useState(!1),[m,x]=u.useState(null),[a,C]=u.useState({email:"",name:"",phone:""}),[t,h]=u.useState({line1:"",line2:"",city:"",state:"",postal_code:"",country:"US"}),w=async s=>{if(!d)throw new Error("Stripe not initialized");if(!a.email||!a.name||!t.line1||!t.city||!t.state||!t.postal_code)throw new Error("Please fill out all required fields before using digital wallet payment");c(!0),x(null);try{const i={customer:a,items:r.map(l=>({variant_id:l.variantId,quantity:l.quantity,unit_price:l.unitPrice,total_price:l.unitPrice*l.quantity,customization:l.customization})),shipping_address:t,billing_address:t,subtotal:n(),tax:0,shipping:0,total:n()},{order:f,client_secret:P}=await N.create(i),{error:g,paymentIntent:y}=await d.confirmCardPayment(P,{payment_method:s});if(g)throw new Error(g.message);y&&y.status==="succeeded"&&(await N.capturePayment(f.id,y.id),v(),o(`/orders/${f.order_number}`))}catch(i){throw console.error("Checkout error:",i),x(i.message||"Payment failed. Please try again."),i}finally{c(!1)}},E=async s=>{if(s.preventDefault(),!(!d||!p)){c(!0),x(null);try{const i={customer:a,items:r.map(b=>({variant_id:b.variantId,quantity:b.quantity,unit_price:b.unitPrice,total_price:b.unitPrice*b.quantity,customization:b.customization})),shipping_address:t,billing_address:t,subtotal:n(),tax:0,shipping:0,total:n()},{order:f,client_secret:P}=await N.create(i),g=p.getElement(S);if(!g)throw new Error("Card element not found");const{error:y,paymentIntent:l}=await d.confirmCardPayment(P,{payment_method:{card:g,billing_details:{name:a.name,email:a.email}}});if(y)throw new Error(y.message);l&&l.status==="succeeded"&&(await N.capturePayment(f.id,l.id),v(),o(`/orders/${f.order_number}`))}catch(i){console.error("Checkout error:",i),x(i.message||"Payment failed. Please try again.")}finally{c(!1)}}};return r.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-gray-600 text-lg mb-4",children:"Your cart is empty"}),e.jsx("button",{onClick:()=>o("/products"),className:"btn-primary",children:"Continue Shopping"})]}):e.jsxs("form",{onSubmit:E,className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Customer Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:a.email,onChange:s=>C({...a,email:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:a.name,onChange:s=>C({...a,name:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:a.phone,onChange:s=>C({...a,phone:s.target.value}),className:"input"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Shipping Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 1"}),e.jsx("input",{type:"text",required:!0,value:t.line1,onChange:s=>h({...t,line1:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 2"}),e.jsx("input",{type:"text",value:t.line2,onChange:s=>h({...t,line2:s.target.value}),className:"input"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"City"}),e.jsx("input",{type:"text",required:!0,value:t.city,onChange:s=>h({...t,city:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"State"}),e.jsx("input",{type:"text",required:!0,value:t.state,onChange:s=>h({...t,state:s.target.value}),className:"input"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",required:!0,value:t.postal_code,onChange:s=>h({...t,postal_code:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Country"}),e.jsxs("select",{value:t.country,onChange:s=>h({...t,country:s.target.value}),className:"input",children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Payment Information"}),e.jsx(z,{totalAmount:n(),onPaymentSuccess:w,disabled:j}),e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg",children:e.jsx(S,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})})]}),m&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:m})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card sticky top-24",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 mb-6",children:r.map(s=>e.jsxs("div",{className:"flex gap-3 pb-3 border-b",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:s.productTitle}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.variantColor," / ",s.variantSize]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold",children:["$",(s.unitPrice*s.quantity).toFixed(2)]})})]},s.id))}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",n().toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:"FREE"})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"$0.00"})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary-600",children:["$",n().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:!d||j,className:"btn-primary w-full",children:j?"Processing...":`Pay $${n().toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-4 text-center",children:"Your payment information is secure and encrypted."})]})})]})}function D(){return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Checkout"}),e.jsx(R,{stripe:F,children:e.jsx(L,{})})]})}export{D as default};
