import{a as h,s as g,e as x,j as e}from"./index-stfxjAP2.js";import{e as f,r as u}from"./react-vendor-Byl6S4M9.js";import"./auth-vendor-BK_4TCcA.js";function y(){const t=f(),{login:d}=h(),[o,n]=u.useState("");u.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:{session:s},error:a}=await g.auth.getSession();if(a)throw console.error("Session error:",a),a;if(s?.user){const{email:r,user_metadata:i}=s.user,c=i?.full_name||i?.name||r?.split("@")[0]||"User";try{await x.register(r,"oauth-"+s.user.id,c)}catch{}try{await d(r,"oauth-"+s.user.id),t("/dashboard")}catch(l){console.error("Login error:",l),localStorage.setItem("auth_token",s.access_token),localStorage.setItem("oauth_user",JSON.stringify({id:s.user.id,email:r,name:c})),window.location.href="/dashboard"}}else console.error("No session found"),n("No session found. Please try again."),setTimeout(()=>t("/login"),2e3)}catch(s){console.error("OAuth callback error:",s),n(s.message||"Authentication failed. Please try again."),setTimeout(()=>t("/login"),2e3)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-600 mb-4",children:o}),e.jsx("p",{className:"text-gray-600",children:"Redirecting to login..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-black mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Completing sign in..."})]})})})}export{y as default};
