import{j as e,u as P,o as f}from"./index-BNHmJ-yo.js";import{e as _,r as c}from"./react-vendor-Byl6S4M9.js";import{E as q,l as w,u as A,a as I,C}from"./stripe-vendor-BtX2Zw4f.js";import"./auth-vendor-BK_4TCcA.js";const L=w("pk_test_51S6MQDEDQ6axpLThLLd3vs0vMlnBCJJ5rJnTonlS2iaMWrBii8UXoosY3CLLoXqOu7SyqhapEC7WTapzAuG4QtJR00CZ7ndWUt");function F(){const u=_(),d=A(),p=I(),{items:o,getTotalPrice:r,clearCart:S}=P(),[h,j]=c.useState(!1),[b,g]=c.useState(null),[t,m]=c.useState({email:"",name:"",phone:""}),[a,l]=c.useState({line1:"",line2:"",city:"",state:"",postal_code:"",country:"US"}),E=async s=>{if(s.preventDefault(),!(!d||!p)){j(!0),g(null);try{const i={customer:t,items:o.map(n=>({variant_id:n.variantId,quantity:n.quantity,unit_price:n.unitPrice,total_price:n.unitPrice*n.quantity,customization:n.customization})),shipping_address:a,billing_address:a,subtotal:r(),tax:0,shipping:0,total:r()},{order:y,client_secret:k}=await f.create(i),v=p.getElement(C);if(!v)throw new Error("Card element not found");const{error:N,paymentIntent:x}=await d.confirmCardPayment(k,{payment_method:{card:v,billing_details:{name:t.name,email:t.email}}});if(N)throw new Error(N.message);x&&x.status==="succeeded"&&(await f.capturePayment(y.id,x.id),S(),u(`/orders/${y.order_number}`))}catch(i){console.error("Checkout error:",i),g(i.message||"Payment failed. Please try again.")}finally{j(!1)}}};return o.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-gray-600 text-lg mb-4",children:"Your cart is empty"}),e.jsx("button",{onClick:()=>u("/products"),className:"btn-primary",children:"Continue Shopping"})]}):e.jsxs("form",{onSubmit:E,className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Customer Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:t.email,onChange:s=>m({...t,email:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:t.name,onChange:s=>m({...t,name:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:t.phone,onChange:s=>m({...t,phone:s.target.value}),className:"input"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Shipping Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 1"}),e.jsx("input",{type:"text",required:!0,value:a.line1,onChange:s=>l({...a,line1:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 2"}),e.jsx("input",{type:"text",value:a.line2,onChange:s=>l({...a,line2:s.target.value}),className:"input"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"City"}),e.jsx("input",{type:"text",required:!0,value:a.city,onChange:s=>l({...a,city:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"State"}),e.jsx("input",{type:"text",required:!0,value:a.state,onChange:s=>l({...a,state:s.target.value}),className:"input"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",required:!0,value:a.postal_code,onChange:s=>l({...a,postal_code:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Country"}),e.jsxs("select",{value:a.country,onChange:s=>l({...a,country:s.target.value}),className:"input",children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Payment Information"}),e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg",children:e.jsx(C,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:b})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card sticky top-24",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 mb-6",children:o.map(s=>e.jsxs("div",{className:"flex gap-3 pb-3 border-b",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:s.productTitle}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.variantColor," / ",s.variantSize]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold",children:["$",(s.unitPrice*s.quantity).toFixed(2)]})})]},s.id))}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",r().toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:"FREE"})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"$0.00"})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary-600",children:["$",r().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:!d||h,className:"btn-primary w-full",children:h?"Processing...":`Pay $${r().toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-4 text-center",children:"Your payment information is secure and encrypted."})]})})]})}function D(){return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Checkout"}),e.jsx(q,{stripe:L,children:e.jsx(F,{})})]})}export{D as default};
