import{j as e,u as k,o as N}from"./index-stfxjAP2.js";import{r as u,e as _}from"./react-vendor-Byl6S4M9.js";import{u as S,P as R,E as I,l as M,a as T,C as q}from"./stripe-vendor-MUlDB4Bh.js";import"./auth-vendor-BK_4TCcA.js";function z({totalAmount:d,onPaymentSuccess:m}){const p=S(),[n,l]=u.useState(null),[v,j]=u.useState(!1);return u.useEffect(()=>{if(!p)return;const o=p.paymentRequest({country:"US",currency:"usd",total:{label:"Total",amount:Math.round(d*100)},requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:!0,requestShipping:!0,shippingOptions:[{id:"free-shipping",label:"Free Shipping",detail:"Arrives in 5-7 business days",amount:0}]});return o.canMakePayment().then(r=>{console.log("[Payment Request] Can make payment:",r),r?(l(o),j(!0),console.log("[Payment Request] Apple Pay/Google Pay available!")):console.log("[Payment Request] No digital wallets available")}).catch(r=>{console.error("[Payment Request] Error checking payment availability:",r)}),o.on("paymentmethod",async r=>{try{await m(r.paymentMethod.id),r.complete("success")}catch(x){console.error("Payment failed:",x),r.complete("fail")}}),()=>{o.off("paymentmethod")}},[p,d,m]),u.useEffect(()=>{n&&n.update({total:{label:"Total",amount:Math.round(d*100)}})},[d,n]),!v||!n?null:e.jsxs("div",{className:"mb-6",children:[e.jsx(R,{options:{paymentRequest:n,style:{paymentRequestButton:{type:"default",theme:"dark",height:"48px"}}}}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-500",children:"Or pay with card"})})]})]})}const A=M("pk_test_51S6MQDEDQ6axpLThLLd3vs0vMlnBCJJ5rJnTonlS2iaMWrBii8UXoosY3CLLoXqOu7SyqhapEC7WTapzAuG4QtJR00CZ7ndWUt");function F(){const d=_(),m=S(),p=T(),{items:n,getTotalPrice:l,clearCart:v}=k(),[j,o]=u.useState(!1),[r,x]=u.useState(null),[a,P]=u.useState({email:"",name:"",phone:""}),[s,h]=u.useState({line1:"",line2:"",city:"",state:"",postal_code:"",country:"US"}),w=async t=>{if(!m)throw new Error("Stripe not initialized");if(!a.email||!a.name||!s.line1||!s.city||!s.state||!s.postal_code)throw new Error("Please fill out all required fields before using digital wallet payment");o(!0),x(null);try{const i={customer:a,items:n.map(c=>({variant_id:c.variantId,quantity:c.quantity,unit_price:c.unitPrice,total_price:c.unitPrice*c.quantity,customization:c.customization})),shipping_address:s,billing_address:s,subtotal:l(),tax:0,shipping:0,total:l()},{order:g,client_secret:C}=await N.create(i),{error:f,paymentIntent:y}=await m.confirmCardPayment(C,{payment_method:t});if(f)throw new Error(f.message);y&&y.status==="succeeded"&&(await N.capturePayment(g.id,y.id),v(),d(`/orders/${g.order_number}`))}catch(i){throw console.error("Checkout error:",i),x(i.message||"Payment failed. Please try again."),i}finally{o(!1)}},E=async t=>{if(t.preventDefault(),!(!m||!p)){o(!0),x(null);try{const i={customer:a,items:n.map(b=>({variant_id:b.variantId,quantity:b.quantity,unit_price:b.unitPrice,total_price:b.unitPrice*b.quantity,customization:b.customization})),shipping_address:s,billing_address:s,subtotal:l(),tax:0,shipping:0,total:l()},{order:g,client_secret:C}=await N.create(i),f=p.getElement(q);if(!f)throw new Error("Card element not found");const{error:y,paymentIntent:c}=await m.confirmCardPayment(C,{payment_method:{card:f,billing_details:{name:a.name,email:a.email}}});if(y)throw new Error(y.message);c&&c.status==="succeeded"&&(await N.capturePayment(g.id,c.id),v(),d(`/orders/${g.order_number}`))}catch(i){console.error("Checkout error:",i),x(i.message||"Payment failed. Please try again.")}finally{o(!1)}}};return n.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-gray-600 text-lg mb-4",children:"Your cart is empty"}),e.jsx("button",{onClick:()=>d("/products"),className:"btn-primary",children:"Continue Shopping"})]}):e.jsxs("form",{onSubmit:E,className:"grid lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Customer Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:a.email,onChange:t=>P({...a,email:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:a.name,onChange:t=>P({...a,name:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:a.phone,onChange:t=>P({...a,phone:t.target.value}),className:"input"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Shipping Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 1"}),e.jsx("input",{type:"text",required:!0,value:s.line1,onChange:t=>h({...s,line1:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Address Line 2"}),e.jsx("input",{type:"text",value:s.line2,onChange:t=>h({...s,line2:t.target.value}),className:"input"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"City"}),e.jsx("input",{type:"text",required:!0,value:s.city,onChange:t=>h({...s,city:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"State"}),e.jsx("input",{type:"text",required:!0,value:s.state,onChange:t=>h({...s,state:t.target.value}),className:"input"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",required:!0,value:s.postal_code,onChange:t=>h({...s,postal_code:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Country"}),e.jsxs("select",{value:s.country,onChange:t=>h({...s,country:t.target.value}),className:"input",children:[e.jsx("option",{value:"US",children:"United States"}),e.jsx("option",{value:"CA",children:"Canada"})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Payment Information"}),e.jsx(z,{totalAmount:l(),onPaymentSuccess:w,disabled:j}),e.jsx("div",{className:"p-4 border border-gray-300 rounded-lg",children:e.jsx(q,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})})]}),r&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:r})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"card sticky top-24",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 mb-6",children:n.map(t=>e.jsxs("div",{className:"flex gap-3 pb-3 border-b",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:t.productTitle}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.variantColor," / ",t.variantSize]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",t.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold",children:["$",(t.unitPrice*t.quantity).toFixed(2)]})})]},t.id))}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",l().toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:"FREE"})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"$0.00"})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary-600",children:["$",l().toFixed(2)]})]})]}),e.jsx("button",{type:"submit",disabled:!m||j,className:"btn-primary w-full",children:j?"Processing...":`Pay $${l().toFixed(2)}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-4 text-center",children:"Your payment information is secure and encrypted."})]})})]})}function D(){return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsx("h1",{className:"text-4xl font-bold mb-8",children:"Checkout"}),e.jsx(I,{stripe:A,children:e.jsx(F,{})})]})}export{D as default};
