import{c as H,j as e,X as O,S as B}from"./index-B6nJwNas.js";import{r as a,R as J}from"./react-vendor-Byl6S4M9.js";import{S as Q,L as Z,I as q,T as ee,K as te}from"./canvas-vendor-C8lZMoyO.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=H("ArrowDownToLine",[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=H("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=H("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),L={front:"/assets/hoodie-black-front.png",back:"/assets/hoodie-black-back.png",neck:"/assets/hoodie-black-back.png"},K=600,M=700,G=1.15,se=a.forwardRef(({artworks:m=[],onArtworkPositionChange:f,onArtworkDelete:g,view:o="front"},j)=>{const[c,b]=a.useState(null),[u,v]=a.useState([]),[d,i]=a.useState(null),x=a.useRef([]),p=a.useRef(null),h=a.useRef(null),N=a.useRef({front:null,back:null,neck:null}),w=a.useRef(new Map),[C,F]=a.useState({width:690,height:805});a.useImperativeHandle(j,()=>({downloadImage:()=>{if(!h.current)return;i(null);const n=h.current.toDataURL({pixelRatio:3,mimeType:"image/png",quality:1}),t=document.createElement("a");t.download="hoodie-design.png",t.href=n,document.body.appendChild(t),t.click(),document.body.removeChild(t)},captureImage:()=>h.current?(i(null),h.current.toDataURL({pixelRatio:2,mimeType:"image/png",quality:.9})):null,getThumbnailBlob:async()=>{if(!h.current)return null;const n=h.current.toDataURL({pixelRatio:1,mimeType:"image/png",quality:.8});return await(await fetch(n)).blob()},deselect:()=>{i(null)}}));const z=n=>new Promise(t=>{const s=new window.Image;s.src=n,s.crossOrigin="anonymous",s.onload=()=>t(s),s.onerror=()=>t(s)}),U=n=>{const t=n.width/n.height;let s=K,r=K/t;return r>M&&(r=M,s=M*t),s*=G,r*=G,{width:s,height:r}};a.useEffect(()=>{Promise.all([z(L.front),z(L.back),z(L.neck)]).then(([n,t,s])=>{N.current={front:n,back:t,neck:s};const r=o==="neck"?s:o==="back"?t:n;F(U(r)),b(r)})},[]),a.useEffect(()=>{const n=N.current,t=o==="neck"?n.neck:o==="back"?n.back:n.front;t&&(F(U(t)),b(t))},[o]),a.useEffect(()=>{const n=t=>{if((t.key==="Delete"||t.key==="Backspace")&&d&&g){const s=parseInt(d.split("-")[1]);isNaN(s)||(g(s),i(null))}};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[d,g]),a.useEffect(()=>{if(m.length===0){v([]),i(null),x.current=[];return}(async()=>{const t=m.map(s=>{const r=w.current.get(s.url);return r?Promise.resolve(r):new Promise((S,I)=>{const y=new window.Image;y.src=s.url,y.crossOrigin="anonymous",y.onload=()=>{w.current.set(s.url,y),S(y)},y.onerror=I})});try{const s=await Promise.all(t);v(s),x.current=new Array(s.length).fill(null);const r=m[m.length-1];r&&!r.position&&i(`artwork-${m.length-1}`)}catch(s){console.error("Failed to load artworks:",s)}})()},[m]),a.useEffect(()=>{if(d&&p.current){const n=parseInt(d.split("-")[1]),t=x.current[n];t&&(p.current.nodes([t]),p.current.getLayer()?.batchDraw())}},[d]);const $=n=>{const t=x.current[n];t&&f&&f({x:t.x(),y:t.y(),scaleX:t.scaleX(),scaleY:t.scaleY(),rotation:t.rotation()},n)},P=n=>{const t=n.target===n.target.getStage(),s=n.target instanceof te.Image&&n.target.image()===c;(t||s)&&i(null)};return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:e.jsxs("div",{className:"relative flex items-center justify-center",style:{transform:typeof window<"u"&&window.innerWidth<640?`scale(${Math.min(window.innerWidth/600,1)})`:"scale(1)",transformOrigin:"center center"},children:[u.length>0&&d&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-black/80 text-white text-xs px-4 py-2 rounded-full z-10",children:"Drag to move â€¢ Corners to resize â€¢ Rotate to spin â€¢ Click away to finish"}),u.length>0&&!d&&e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-gray-800/60 text-white text-xs px-4 py-2 rounded-full z-10",children:"Click artwork to edit position and size"}),e.jsx(Q,{ref:h,width:C.width,height:C.height,onMouseDown:P,onTouchStart:P,children:e.jsxs(Z,{children:[c&&e.jsx(q,{image:c,x:0,y:o==="back"?-20:0,width:C.width,height:C.height,onClick:()=>i(null),onTap:()=>i(null)}),u.map((n,t)=>{const s=m[t];if(!s)return null;const r=250,S=250,I=n.width/n.height;let y=r,A=r/I;return A>S&&(A=S,y=S*I),e.jsxs(J.Fragment,{children:[e.jsx(q,{ref:k=>{x.current[t]=k},image:n,x:s.position?.x??270+t*20,y:s.position?.y??250+t*20,width:y,height:A,scaleX:s.position?.scaleX??1,scaleY:s.position?.scaleY??1,rotation:s.position?.rotation??0,draggable:!0,dragBoundFunc:k=>{const l=o==="back"?{minX:120,maxX:510,minY:100,maxY:650}:{minX:150,maxX:540,minY:100,maxY:650},D=x.current[t];if(!D)return k;const E=D.getClientRect(),W=E.width,_=E.height;let R=k.x,T=k.y;const X=E.x-D.x(),Y=E.y-D.y();return R+X<l.minX&&(R=l.minX-X),R+X+W>l.maxX&&(R=l.maxX-W-X),T+Y<l.minY&&(T=l.minY-Y),T+Y+_>l.maxY&&(T=l.maxY-_-Y),{x:R,y:T}},onClick:()=>i(`artwork-${t}`),onTap:()=>i(`artwork-${t}`),onDragEnd:()=>$(t),onTransformEnd:()=>$(t)}),d===`artwork-${t}`&&e.jsx(ee,{ref:p,keepRatio:!0,boundBoxFunc:(k,l)=>l.width<50||l.height<50||l.width>400||l.height>400?k:l,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],rotateEnabled:!0,borderStroke:"#000000",borderStrokeWidth:2,anchorSize:12,anchorStroke:"#000000",anchorFill:"#ffffff",anchorCornerRadius:6})]},`artwork-${t}`)})]})})]})})});se.displayName="HoodieCanvas";function ce({isOpen:m,onClose:f,onSave:g,isUpdating:o=!1,currentName:j=""}){const[c,b]=a.useState(j),[u,v]=a.useState(!1),[d,i]=a.useState(!1),[x,p]=a.useState(""),h=async()=>{if(!c.trim()){p("Please enter a name for your design");return}v(!0),p("");try{await g(c.trim()),i(!0),setTimeout(()=>{f(),i(!1),b("")},1500)}catch(w){p(w.message||"Failed to save design"),v(!1)}},N=()=>{u||(f(),b(""),p(""),i(!1))};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold",children:o?"Update Design":"Save Design"}),!u&&e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(O,{size:24})})]}),e.jsx("div",{className:"p-6",children:d?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:e.jsx(V,{size:32,className:"text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o?"Design Updated!":"Design Saved!"}),e.jsxs("p",{className:"text-gray-600",children:['Your design "',c,'" has been saved to your dashboard']})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"design-name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Design Name"}),e.jsx("input",{id:"design-name",type:"text",value:c,onChange:w=>b(w.target.value),onKeyPress:w=>w.key==="Enter"&&h(),placeholder:"e.g., Summer Collection Tee",className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent",disabled:u,autoFocus:!0}),x&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:x})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Give your design a memorable name so you can easily find it later!"]})})]})}),!d&&e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:N,disabled:u,className:"flex-1 px-4 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:u||!c.trim(),className:"flex-1 px-4 py-3 bg-black text-white rounded-md hover:bg-gray-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):o?"Update Design":"Save Design"})]})]})}):null}function de({message:m,type:f="success",onClose:g,duration:o=3e3}){a.useEffect(()=>{const b=setTimeout(()=>{g()},o);return()=>clearTimeout(b)},[g,o]);const j={success:e.jsx(V,{size:20}),error:e.jsx(O,{size:20}),info:e.jsx(B,{size:20})},c={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"};return e.jsxs("div",{className:"fixed bottom-8 right-8 z-50 animate-slideUp",role:"alert",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden max-w-md",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4",children:[e.jsx("div",{className:`${c[f]} text-white p-2 rounded-xl flex-shrink-0`,children:j[f]}),e.jsx("p",{className:"text-gray-900 font-medium flex-1",children:m}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"Close",children:e.jsx(O,{size:18})})]}),e.jsx("div",{className:"h-1 bg-gray-100",children:e.jsx("div",{className:`h-full ${c[f]} transition-all`,style:{animation:`shrink ${o}ms linear`,transformOrigin:"left"}})})]}),e.jsx("style",{children:`
        @keyframes slideUp {
          from {
            transform: translateY(100px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        @keyframes shrink {
          from {
            width: 100%;
          }
          to {
            width: 0%;
          }
        }
      `})]})}export{oe as A,se as H,ie as S,de as T,le as U,ce as a};
