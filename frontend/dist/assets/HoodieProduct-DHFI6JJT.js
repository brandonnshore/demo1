import{u as le,a as ne,j as e,b as I,d as T}from"./index-CgNUpRIG.js";import{e as ie,r as c,f as ce,L as de}from"./react-vendor-Byl6S4M9.js";import{A as me,S as xe,H as ue,U as B,a as he,T as ge}from"./Toast-DKzjlPEa.js";import"./auth-vendor-Cg5HAGal.js";import"./canvas-vendor-C8lZMoyO.js";import"./x-DNMsmAvo.js";const fe="9f9e4e98-4128-4d09-af21-58e5523eed14",J="Black",pe=["S","M","L","XL","2XL"],W=35.99,be=5,ke=1,A=4,K={S:"242180eb-3029-40bc-b185-7ae8e3328b31",M:"677f0bf4-98b9-4088-9151-7422312bbf76",L:"d6495a9b-0e81-40f7-81e4-3cf09eb25f2a",XL:"be75094a-c54b-4e3e-b861-b57aaaf2c774","2XL":"0e302d1c-ce97-4a69-96df-eb603fca599e"};function Ie(){const G=ie(),Q=le(t=>t.addItem),f=c.useRef(null),{isAuthenticated:_}=ne(),[M]=ce(),[b,z]=c.useState(null),[q,D]=c.useState(!1),[U,P]=c.useState(""),[Z,v]=c.useState(!1),[Y,H]=c.useState(""),[h,V]=c.useState("M"),[y,ee]=c.useState(1),[o,g]=c.useState("front"),[d,k]=c.useState([]),[m,j]=c.useState([]),[n,w]=c.useState(null),[L,N]=c.useState(!1),[F,S]=c.useState(!1),[O,C]=c.useState(!1),te=()=>o==="front"?d:o==="neck"?n?[n]:[]:o==="back"?m:[],E=(()=>{let t=W;return[d.length>0,m.length>0].filter(Boolean).length===2&&(t+=be),n!==null&&(t+=ke),t})(),R=async t=>{const s=t.target.files?.[0];if(!s)return;t.target.value="";const u={url:URL.createObjectURL(s),position:null,assetId:void 0};if(o==="front"){if(d.length>=A){alert(`Maximum ${A} artworks allowed on front view`);return}const a=d.length;k([...d,u]),I.uploadFile(s).then(l=>{k(i=>{const x=[...i];return x[a]&&(x[a]={...x[a],url:`http://localhost:3001${l.file_url}`,assetId:l.id}),x})}).catch(l=>console.error("Upload failed:",l))}else if(o==="neck"){if(n){alert("Only 1 artwork allowed on neck view");return}w(u),I.uploadFile(s).then(a=>{w(l=>l?{...l,url:`http://localhost:3001${a.file_url}`,assetId:a.id}:null)}).catch(a=>console.error("Upload failed:",a))}else if(o==="back"){if(m.length>=A){alert(`Maximum ${A} artworks allowed on back view`);return}const a=m.length;j([...m,u]),I.uploadFile(s).then(l=>{j(i=>{const x=[...i];return x[a]&&(x[a]={...x[a],url:`http://localhost:3001${l.file_url}`,assetId:l.id}),x})}).catch(l=>console.error("Upload failed:",l))}},se=()=>{if(!h){alert("Please select a size");return}let t;try{f.current?.captureImage&&(t=f.current.captureImage()||void 0)}catch(r){console.error("Error capturing mockup:",r)}const s={id:`hoodie-${h}-${Date.now()}`,variantId:`hoodie-${h}`,productTitle:"Classic Hoodie",variantColor:J,variantSize:h,quantity:y,unitPrice:E,customization:{method:"dtg",frontArtworks:d,backArtworks:m,neckArtwork:n},mockupUrl:t};Q(s),G("/cart")},ae=()=>{f.current&&f.current.downloadImage&&f.current.downloadImage()},re=async()=>{if(!_){G("/login",{state:{from:window.location.pathname+window.location.search}});return}if(b&&U){try{await X(U),H("Design updated successfully!"),v(!0),setTimeout(()=>v(!1),3e3)}catch(t){console.error("Error updating design:",t),alert("Failed to update design")}return}D(!0)},X=async t=>{try{const s={front:d.map(a=>a.position),back:m.map(a=>a.position),neck:n?[n.position]:[],selectedColor:J,selectedSize:h},r=[...d.filter(a=>a.assetId).map(a=>a.assetId),...m.filter(a=>a.assetId).map(a=>a.assetId),...n?.assetId?[n.assetId]:[]];let u="";if(f.current?.getThumbnailBlob)try{const a=await f.current.getThumbnailBlob();if(a){const l=new File([a],"thumbnail.png",{type:"image/png"});u=(await I.uploadFile(l)).file_url}}catch(a){console.error("Failed to capture thumbnail:",a)}if(b)await T.update(b,{name:t,variantId:K[h],designData:s,artworkIds:r,thumbnailUrl:u}),P(t);else{const a=await T.save({name:t,productId:fe,variantId:K[h],designData:s,artworkIds:r,thumbnailUrl:u});z(a.id),P(t)}D(!1),H(b?"Design updated successfully!":"Design saved successfully!"),v(!0),setTimeout(()=>v(!1),3e3)}catch(s){throw console.error("Error saving design:",s),s}};c.useEffect(()=>{o==="neck"?(C(!0),N(!1),S(!1)):o==="front"?(N(!0),S(!1),C(!1)):o==="back"&&(S(!0),N(!1),C(!1))},[o]);const oe=async t=>{try{const s=await T.getById(t);z(s.id),P(s.name);const r=s.artwork_ids||[],u=s.artwork_urls||{},a=i=>!i||i.startsWith("http")?i:`http://localhost:3001${i}`;let l=0;if(s.design_data){if(s.design_data.front?.length>0){const i=s.design_data.front.map(x=>{const p=r[l],$=p?a(u[p]):"";return l++,{url:$,position:x,assetId:p}});k(i)}if(s.design_data.back?.length>0){const i=s.design_data.back.map(x=>{const p=r[l],$=p?a(u[p]):"";return l++,{url:$,position:x,assetId:p}});j(i)}if(s.design_data.neck?.length>0){const i=r[l],x=i?a(u[i]):"";w({url:x,position:s.design_data.neck[0],assetId:i})}s.design_data.selectedSize&&V(s.design_data.selectedSize)}}catch(s){console.error("Error loading design:",s)}};return c.useEffect(()=>{const t=M.get("designId");t&&_&&oe(t)},[M,_]),e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"relative px-6 py-1.5 flex items-center",children:[e.jsx("h1",{className:"text-sm font-bold",children:"Classic Hoodie"}),e.jsx(de,{to:"/",className:"absolute left-1/2 -translate-x-1/2 text-lg font-bold hover:text-gray-600 transition-colors",children:"Raspberry"}),e.jsxs("div",{className:"ml-auto flex items-center gap-4",children:[e.jsx("button",{onClick:ae,disabled:d.length===0&&m.length===0&&!n,title:"Download Design",className:`p-2 rounded-md transition-colors ${d.length>0||m.length>0||n?"hover:bg-gray-100":"opacity-30 cursor-not-allowed"}`,children:e.jsx(me,{size:16})}),e.jsxs("button",{onClick:re,className:"flex items-center gap-1.5 px-4 py-1.5 text-xs font-medium rounded-md transition-colors bg-black text-white hover:bg-gray-800",children:[e.jsx(xe,{size:14}),b?"Update Design":"Save Design"]}),e.jsxs("div",{className:"text-sm font-normal",children:["from $",W.toFixed(2)]})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-[1fr_400px] h-[calc(100vh-40px)]",children:[e.jsxs("div",{className:"bg-white flex flex-col relative h-full overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pt-2 pb-16 px-6",children:e.jsx(ue,{ref:f,artworks:te(),view:o,onArtworkPositionChange:(t,s)=>{if(o==="front"){const r=[...d];r[s]={...r[s],position:t},k(r)}else if(o==="neck"&&n)w({...n,position:t});else if(o==="back"){const r=[...m];r[s]={...r[s],position:t},j(r)}},onArtworkDelete:t=>{o==="front"?k(d.filter((s,r)=>r!==t)):o==="neck"?w(null):o==="back"&&j(m.filter((s,r)=>r!==t))}})}),e.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-white rounded-full shadow-lg px-2 py-2 flex gap-1",children:[e.jsx("button",{onClick:()=>g("front"),className:`px-5 py-2 rounded-full text-sm font-medium transition-colors ${o==="front"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Front"}),e.jsx("button",{onClick:()=>g("back"),className:`px-5 py-2 rounded-full text-sm font-medium transition-colors ${o==="back"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Back"}),e.jsx("button",{onClick:()=>g("neck"),className:`px-5 py-2 rounded-full text-sm font-medium transition-colors ${o==="neck"?"bg-black text-white":"text-gray-700 hover:bg-gray-100"}`,children:"Neck"})]})]}),e.jsx("div",{className:"bg-white border-l border-gray-200 overflow-y-auto",children:e.jsxs("div",{className:"p-5 space-y-1",children:[e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>N(!L),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Front Artwork"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:d.length}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:L?"−":"+"})]})]}),L&&e.jsxs("div",{className:"space-y-4",children:[d.length<4&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>g("front"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:t=>{g("front"),R(t)},className:"hidden",id:"front-artwork-upload",onClick:t=>t.stopPropagation()}),e.jsxs("label",{htmlFor:"front-artwork-upload",className:"cursor-pointer",children:[e.jsx(B,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload front artwork (up to 4)"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),d.map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:t.url,alt:"Front Artwork",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",children:["Artwork ",s+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click front view to edit"})]})]}),e.jsx("button",{onClick:()=>k(d.filter((r,u)=>u!==s)),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})},s))]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>S(!F),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Back Artwork"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:m.length}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:F?"−":"+"})]})]}),F&&e.jsxs("div",{className:"space-y-4",children:[m.length<4&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>g("back"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:t=>{g("back"),R(t)},className:"hidden",id:"back-artwork-upload",onClick:t=>t.stopPropagation()}),e.jsxs("label",{htmlFor:"back-artwork-upload",className:"cursor-pointer",children:[e.jsx(B,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload back artwork (up to 4)"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),m.map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:t.url,alt:"Back Artwork",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium",children:["Artwork ",s+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click back view to edit"})]})]}),e.jsx("button",{onClick:()=>j(m.filter((r,u)=>u!==s)),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})},s))]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsxs("button",{onClick:()=>C(!O),className:"w-full flex items-center justify-between mb-4 group",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Neck Label"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-black text-white text-xs flex items-center justify-center",children:n?"1":"0"}),e.jsx("span",{className:"text-gray-400 group-hover:text-gray-600",children:O?"−":"+"})]})]}),O&&e.jsxs("div",{className:"space-y-4",children:[!n&&e.jsxs("div",{className:"border-2 border-dashed border-gray-200 rounded-md p-6 text-center hover:border-gray-300 transition-colors cursor-pointer",onClick:()=>g("neck"),children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,application/pdf",onChange:t=>{g("neck"),R(t)},className:"hidden",id:"neck-label-upload",onClick:t=>t.stopPropagation()}),e.jsxs("label",{htmlFor:"neck-label-upload",className:"cursor-pointer",children:[e.jsx(B,{className:"mx-auto mb-2 text-gray-300",size:28}),e.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Upload neck label"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, SVG or PDF"})]})]}),n&&e.jsx("div",{className:"border border-gray-200 rounded-md p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white border border-gray-200 rounded flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:n.url,alt:"Neck Label",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",children:"Neck Label"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click neck view to edit"})]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-xs text-red-600 hover:text-red-700",children:"Remove"})]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-5 pb-4",children:[e.jsx("label",{className:"block text-xs font-medium mb-3",children:"Size"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:pe.map(t=>e.jsx("button",{onClick:()=>V(t),className:`px-3 py-2 border rounded-md text-xs font-medium transition-all ${h===t?"border-black bg-black text-white":"border-gray-300 hover:border-gray-400"}`,children:t},t))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-5 pb-4",children:e.jsxs("div",{className:`grid ${y>=2?"grid-cols-3":"grid-cols-2"} gap-3`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:y,onChange:t=>ee(parseInt(t.target.value)||1),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Unit cost"}),e.jsxs("div",{className:"text-sm font-semibold",children:["$",E.toFixed(2)]})]}),y>=2&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-2",children:"Total cost"}),e.jsxs("div",{className:"text-sm font-semibold",children:["$",(E*y).toFixed(2)]})]})]})}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{onClick:se,disabled:!h,className:"w-full py-3 bg-black text-white text-sm font-medium rounded-full hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Add to Cart"})})]})})]}),e.jsx(he,{isOpen:q,onClose:()=>D(!1),onSave:X,isUpdating:!!b,currentName:U}),Z&&e.jsx(ge,{message:Y,onClose:()=>v(!1)})]})}export{Ie as default};
